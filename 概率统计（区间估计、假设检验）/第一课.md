##第一章 概率论基础

本章主要讲解概率论中的基本知识，其中最重要的就是`概率`

什么是概率？概率是关于一个`事件`发生的`可能性大小`的`一种度量`，其值在0和1之间。什么是事件？可以为一件没有发生且可以度量的事。度量本身必须是明确的，度量可以通过实验观察进行验证

- 通常事件发生的结条件果具有`不确定性`，称之为`随机事件`或`偶然事件`；
- 如果事件发生的结果是确定的，称之为`确定性事件`或`必然事件`，其概率为0(`不可能事件`)或1；
- 事件必须严格定义或描述，给出特定条件，例如：条件是我今天晚上上课有没有喝酒。

> 统计学的一重要作用就是可以度量一个事件。统计学只考虑大多数，对于极少数情况是无法预防，针对大众来说趋近于不可能。例如：飞机失事的概率很小，几乎可以忽略，所以大部分人会接受坐飞机。

在原来特定条件下在增加其它条件，此时的事件称为条件事件。条件事件的概率称之为条件概率。

随机变量，随机变量是定量的，事件可以用定量来描述，

概率分布：用来描述随机变量取值概率的分布规律。概率的计算时通过比例得出，度量是通过实验观察或模型得出。

1. 离散随机变量的概率分布

   用列表形式或函数形式给出概率分布
   $$
   P(X = a_i) = p_i，i=1,2,3,... \ 其中 0 \le p_i \le 1 \quad \sum p_i = 1 \\
   E(X) = 1-p，D(X)=p(1-p)
   $$

   **伯努利（Bernoulli）分布** 
   $$
   P(X=1) = p，P(X=0) = 1 - p，0 \le p \le 1
   $$
   **二项（Binomial）分布**
   $$
   P(X=k) = C_k^n p^k (1-p)^{n-k}，k=0,1,2..,n ，0 \lt p \lt 1 \\
   其中n表示独立进行贝努力实验重复次数，k表示1出现的次数 \\
   E(X) = np，D(X) = np(1-p)
   $$
   **泊松（Poisson）分布 ~ P($\lambda$)**
   $$
   P(X=k) = \frac{\lambda^k}{k!} e^{- \lambda}，k=0,1,2，...，\lambda > 0 \\
   E(X) = D(X) = \lambda
   $$
   泊松分布的参数λ是单位时间(或单位面积)内随机事件的平均次数（发生率）。 泊松分布适合于描述单位时间内随机事件发生的次数。k为随机事件的实际发生次数 。

2.  连续随机变量的概率分布

   （概率）密度函数f(x)和（累积）分布函数F(x)满足如下公式
   $$
   F(x) = \int_{-\infty}^x f(x) dx = P(X \le x)，其中f(x) \ge 0
   $$
   **均匀（Uniform）分布 ~ U(a,b)** 
   $$
   f(x) = \begin{cases}
   \frac{1}{b - a} ，a < x < b \\
   0 ，\quad 其他
   \end{cases} \\
   F(x) = \begin{cases}
   0 ，\quad \ x < a \\
   \frac{x - a}{b -a}，a < x < b \\
   1 ，\quad \ x > b
   \end{cases} \\
   E(x) = \frac{a+b}{2}，D(X) = \frac{(b-a)^2}{12}
   $$
   ​

   **正态（Normal / Gaussian）分布 ~ N($\mu$, $\sigma$ )**
   $$
   密度函数 f(x) = \frac{1}{\sqrt{2 \pi}} \sigma e^{\frac{(x- \mu)^2}{s \sigma^2}} ，-\infty \lt x \lt +\infty \\
   分布函数 F(x) = \int_{-\infty}^x \frac{1}{\sqrt{2 \pi}} \sigma e^{\frac{(x- \mu)^2}{s \sigma^2}} d(x) \\
   $$

   其中$\sigma$ 决定曲线的分布程度(胖瘦)，$\sigma$ 越大曲线扁平（胖），反之曲线越瘦高。σ描述正态分布资料数据分布的离散程度，σ越大，数据分布越分散，σ越小，数据分布越集中。


   **标准正态分布**
$$
   若 X \sim N(\mu, \sigma^2)，则Z= \frac{x - \mu}{\sigma} \sim N(0, 1)
$$


数学期望

概率的加权平均值，是随机变量概率分布的重心所在。
$$
离散型 \quad E(X) = \sum_{k=1}^{\infty}p_k x_k \\
连续型 \quad E(X) = \int_{- \infty}^{\infty} x f(x)ds
$$
方差

$E(X - E(x))^2$ 为随机变量X的方差，记作Var(X)或D(X)。方差的开方称为标准差 。方差确定数据的离散程度。

协方差和相关系数

随机变量X与Y的协方差为
$$
Cov(X,Y) = E[X - E(X)] [Y - E(Y)]
$$
称
$$
\rho_{xy} = \frac{Cov(X, Y)}{\sqrt{Var(X)} \sqrt{Var(Y)}} = Cov(\frac{X - E(X)}{\sqrt{Var(X)}} , \frac{Y - E(Y)}{\sqrt{Var(Y)}}) \\
\rho_{xy} \in [-1, 1]
$$
为随机变量X与Y的相关系数。特别的，$Cov(X,X) = Var(X)，Cov(Y，Y)= Var(Y)$

相关系数就相当于二次函数中的交叉项，例如$f(x,y) = x^2 + 2xy + y^2$ ，其中$2xy$ 对应x与y的相关性。

##第二章 样本和统计量

> 统计学就是用来和实际打交道的，统计学是技术中的技术！技术的改进需要收集数据、分析数据，然后建立模型，最后最优化分析进行

`总体`研究对象的全体所组成的集合。`个体`总体中的基本单元或元素。`样本`是来自总体的若干个体所组成的集合。

`总体变量`用来描述个体某方面的数量特征，是关于个体的函数，是研究对象的特征变量。`总体分布`是`总体变量`取值的比例分布。例如：总体分布为男女身高的比例。

`例子1` 产品合格情况统计

总体={某批产品}，个体=某个产品，样本={被抽查的若干产品}，`总体变量`为
$$
X = \begin{cases}
1 ，合格产品\\
0，不合格产品
\end{cases}
$$
`总体分布`为产品分为合格和不合格品，比例分别为p和1-p，记作
$$
P(X=1) = p，P(X=0) = 1-p
$$
`例子2` 城市人口年龄的统计调查

总体={所有北京人}，个体=某个北京人，样本={若干被调查到的北京人}，`总体变量`为X = 年龄(某个北京人)，`总体密度分布`各个年龄的人口比例，`总体累积分布`为小于等于某个年龄x的人口比例，记作
$$
P(X \le x) = p
$$
从随机抽样或试验的角度来看，总体变量就是随机变量，总体分布就是总体变量的概率分布，又称`统计分布`。

其他例子还有人或物的寿命，货运或交通的流量，制造物品的产量，物价或经济指数，炮弹射程或投掷距离，测量误差等。通过量化后，经过随机抽样得到统计规律。

**统计量及其分布** 

什么是统计量？统计量是样本的函数，通过它对样本信息进行提炼，用来估计总体的某个相应特征。常见的统计量有
$$
样本均值 \ \overline X = \sum_{i=1}^{n} X_i \\
样本方差 \ S^2 = \frac{1}{n-1} \sum_{i=1}^{n} (X_i -\overline X)^2
$$
常见统计量的抽样分布

1. 样本比例

   总体为贝努力分布
   $$
   P(X=1) = p，P(X=0) = 1-p \\
   $$
   随机样本$X_1, X_2, X_3, ... X_n$ 的取值为0或1，样本比例
   $$
   \hat{p} = \frac{k}{n} = \frac{X_1 + X_2 + ... + X_n}{n} = \overline{X} 
   $$
   其中‘1’出现的次数k服从二项分布，即
   $$
   P(k=i) = C_n^i p^i (1-p)^{n-i}，i=0,1,2,...,n
   $$

2. 正态分布的样本均值

   正态分布$X ~ N(\mu, \sigma^2)$ ，则其样本均值为
   $$
   \overline X = \frac{X_1 +X_2 + ... + X_n}{n} \sim N(\mu, \frac{\sigma^2}{n})
   $$

3. 两个正态总体的独立样本的均值之差
   $$
   X \sim N(\mu_1， \sigma_1^2)，Y \sim N(\mu_2，\sigma_2^2) \\
   \overline{X} - \overline{Y} \sim N(\mu_1 - \mu_2，\frac{\sigma_1^2}{n_1} + \frac{\sigma_2^2}{n_2})
   $$

4. 正态总体的原本方差

   正态分布$X \sim N(\mu, \sigma^2)$ ，则样本方差
   $$
   S^2 = \frac{1}{n-1} \sum_{i=1}^{n} (X - \overline{X})^2
   $$
   的变换
   $$
   T = (n-1)\frac{S^2}{\sigma^2} = \sum_{i=1}^{n}(\frac{X_i - \overline{X}}{\sigma})^2 \sim T(n-1)
   $$
   其中T(n)称为自由度为n的T-分布
   
5. 两个正态总体的独立样本的方差之比

   当两个正态总体的方差相等时，即$\sigma_1^2 = \sigma_2^2$ ，则
   $$
   F = \frac{S_1^2}{S_2^2} \sim F(n_1 - 1, n_2 -1)
   $$
   其中$F(n_1，n_2)$ 称为自由度$(n_1, n_2)$的F-分布。


**常见统计量的数字特征** 

样本比例(0-1分布)的数据期望和方差
$$
\hat{p} = \frac{k}{n} \\
E(\hat{p}) = p \\
Var(\hat{p}) = \frac{p(1-p)}{n}
$$
样本均值的数学期望和方差
$$
E(\overline{X}) = E(X) = \mu \\
Var(\overline(X)) = \frac{Var(X)}{n} = \frac{\sigma^2}{n}
$$
样本方差的数学期望
$$
E(S^2) = \sigma^2
$$


**标准变换** 

总体变量的标准变换
$$
Z = \frac{X - E(X)}{\sqrt{Var(X)}} = \frac{X - \mu}{\sigma}
$$
样本均值的标准变换
$$
Z = \frac{\overline{X} - \mu}{\sigma /  \sqrt{n}}
$$
**统计量的大样本特性** 

大数定理

当样本量趋于无穷时，随机抽样的样本均值、样本方差和样本标准差都分别趋于总体均值、总体方差和总体标准差，即
$$
\overline{X} \rightarrow \mu \\
S^2 \rightarrow \sigma^2 \\
S \rightarrow \sigma \\
n \rightarrow \infty
$$
中心极限定理

当样本量趋于无穷时，样本均值的标准变换`通常（放在不满足的情况，但可以忽略不计）` 趋向于服从标准正态分布，即
$$
Z_n = \frac{\overline{X} - \mu}{\sigma/\sqrt{n}} \rightarrow Z \sim N(0, 1)，n\rightarrow \infty
$$

> 统计学的真谛就是“差不多”，只要容忍了误差，就会有不同的结果。例如：飞机可以座，火车可以开。



##第三讲 参数估计

考虑最简单为题：能不能用100个人的平均身高代表100万个人的平均身高，误差不超过1厘米？能不能用一个人的身高代表100万个人的平均身高？当选择的这个人恰好是其中的平均身高时，就能够实现。因此通过选择合适的样本数量可以估计总体的平均身高。用统计量（样本）估计总体分布中的未知参数。

问题由来？统计量是样本的特征（随机变量），用它来估计总体的相应特征（确定的未知参数），就带有不确定性（误差）。如何来描述统计量估计的好坏？

为什么要随机抽样？等概率抽取样本，不会出现抽取数据出现明显偏差的情况，抽样量越多出现的误差越小。

**统计量（点估计）的好坏选择**

`无偏性`：统计量T的期望值等于被估计参数$\theta$,即$E(T)=\theta$ 。无偏估计的两个要求：

1. 样本要是随机的；
2. `有效性`：要求统计量T的方差Var(T)越小越好，或者要求统计量T与被估计参数$\theta$ 的偏差均方$E(T-\theta)^2$ 越小越好。

用样本方差估计总体方差是无偏的，但是样本标准差与总体方差就是有偏的。

**区间估计** 

置信区间：用称之为置信下限和置信上限的两个统计量T1和T2所组成的区间$[T_1, T_2]$ 来估计未知参数$\theta$ ，称$[T_1, T_2]$ 为$\theta$ 的置信区间。

置信度：记$P(T_1 \le \theta \le T_2) = 1- \alpha$ ，称$1-  \alpha$ 为$\theta$ 的置信区间$[T_1, T_2]$的`置信度`，称$\alpha$ 为`置信水平`。$\alpha$ 代表是小概率，一般$\alpha$ 取值为0.05或0.01。

**正态总体均值的估计** 

1. 正态总体$N(\mu, \sigma^2)$ 中，$\sigma^2$ 已知的情形

   正态总体的随机样本$X_1, X_2, ..., X_n$ 的任意线性组合
   $$
   T = c_1 X_1 + c_2 X_2 + ... + c_n X_n
   $$
   也服从正态分布，即
   $$
   T \sim N(E(T), Var(T)) =N(\mu(c_1 +c_2+...+c_n), \sigma^2(c_1^2 + ... + c_n^2))
   $$
   样本均值$\overline{X}$ 服从$N(\mu, \sigma^2/n)$ ，其标准变换为
   $$
   Z = \frac{\overline{X} - \mu}{\sigma/\sqrt{n}} \sim N(0, 1)
   $$
   用标准变换构造正态总体均值的区间估计

   ![区间估计](img/区间估计.png)

   ​
   $$
   P(|Z| \le z_{\alpha/2}) = 1- \alpha \\
   P(\frac{| \overline{X} - \mu |}{\sigma/\sqrt{n}}  \le z_{\alpha/2}) = 1- \alpha 或 \\
   P(|\overline{X} - \mu | \le z_{\alpha/2} \sigma/\sqrt{n}) = 1- \alpha
   $$
   因此，$\mu$ 的置信区间为$[\overline{X} - z_{\alpha/2} \sigma/\sqrt{n}, \overline{X} + z_{\alpha/2} \sigma/\sqrt{n}]$ ，其置信度为$1 - \alpha$

   例子：随机抽取了20名男生的体重，得平均体重为68公斤，用它来估计全体学生的平均体重（已知总体标准差为6公斤），则在置信度95%下，$\alpha=0.05$，则 其估计误差为
   $$
   \Delta Z_{\alpha/2} \frac{\sigma}{\sqrt{n}} = 1.960 * \frac{6}{\sqrt{20}} = 2.63（公斤）
   $$

2. 正态总体$N(\mu, \sigma^2)$ 中，$\sigma^2$ 未知的情形

   利用$\sigma^2$ 已知情形的结果，用样本方差$S^2$ 替换未知的总体方差$\sigma^2$ ,经过变换后的的分布称为T分布
   $$
   T = \frac{\overline{X} - \mu}{S / \sqrt{n}} \sim T(n-1)
   $$
   其中T(n-1)称为自由度为n-1的T分布，记
   $$
   P(|T| \le t_{n-1, \alpha/2})
   $$
   ![T分布](img/T分布.png)


   可以得到$\mu$ 的区间估计的置信区间为$[\overline{X} - t_{n-1, \alpha/2}S/\sqrt{n},\overline{X} + t_{n-1, \alpha/2} S/\sqrt{n}]$

   ​

3. 样本量的确定

   在置信度为$1 - \alpha$ 和估计误差$\Delta$ 给定的情况下，解
   $$
   z_{\alpha/2} \sigma \sqrt{n} = \Delta \\
   方差已知时样本量的计算公式 n = z_{\alpha/2}^2 \frac{\sigma^2}{\Delta^2}\\
   方差未知时样本量的计算公式n = t_{n-1, \alpha/2}^2 \frac{S^2}{\Delta^2}
   $$
   样本量与误差大小平方成反比，若缩小误差10倍，则需要样本量扩大100倍。

   **方差未知时，样本量计算公式的使用** 

   - 第一步，先用经验方法估计出样本量n的最小值$n^{(1)}$和最大值$n^{(2)}$ ，接着抽一个样本量为$n_1=n^{(1)}$ 的样本得到样本方差$S_1^2$ 

   - 第二步，补抽一个样本量为$n_2 - n_1$ 的样本其中
     $$
     n_2 = MIN(t_{n_1-1, \alpha/2}^2 \frac{S_1^2}{\Delta^2}, \  n^{(2)})
     $$
     把前后两个样本合起来，就得到了样本量为$n=n_2$ 的一个样本，其样本方差为$S_2^2$ 

     1. 若$n_2 \le n_1$ ，则$n_1 \ge n$ ，因此不需要进行第二步了；
     2. 计算$n_3 =t_{n_1-1, \alpha/2}^2 \frac{S_2^2}{\Delta^2}​$ ，通常$n_3​$ 与$n_2​$ 应该差距不大，否则可以考虑第三步。

   `例子`：若要求身高的估计误差小于1cm，有经验可知，总体标准差在4.5~5之间，因此有公式可计算（找置信度95%下）样本量约在78-96之间，第一步，取$n_1 = 80$ ，第二步需要补抽的样本量应该不会很大，若$n_1$取的过小，则$n_2$就会过大，例如$n_1=10$，则$n_2 = t_{n-1, \alpha/2}^2 \frac{S_1^2}{\Delta} = 2.262^2 * 7.5865^2 / 1^2 = 294$

4. 非正态总体均值的大样本估计

   对于非正态总体，当样本量n很大时，利用中心极限定理得
   $$
   T = \frac{\overline{X} - \mu}{S/\sqrt{n}} \sim N(0,1)
   $$
   由此得到非正态总体均值$\mu$  的近似区间估计，$\mu$ 的执行区间为$\overline{X} \pm z_{\alpha/2} S/\sqrt{n}$ ，置信度为$1-\alpha$

   样本量n多大时，近似程度才较好呢？

   - n的大小，依赖与总体分布与正态分布的接近程度，两者成反比例；
   - 理论上，若总体分布为正态分布，则n可以任意；
   - 一般要求$n \ge 30 或 n \ge 50$
   - 对于特别偏倚的分布，则要求n特别大。

5. 有限总体无放回随机抽样的均值估计

   设有限总体的个体数目为N，从中无放回地随机抽取n个个体，得到样本$X_1, X_2, ... X_n $ ，此时，有限总体的均值为$\mu$ 仍用样本均值来估计，这个估计仍然是无偏估计，但其估计方差要进行修整
   $$
   Var(\overline{X}) = \frac{N-n}{N} \frac{\sigma2}{n} = C^2\frac{\sigma2}{n}，其中C = \sqrt{1 - n/N}
   $$
   其中C为有放回随机抽样的修整系数，因此在大样本下可以得到均值$\mu$ 的近似区间估计为
   $$
   [\overline{X} - z_{\alpha/2} C S/\sqrt{n}，\overline{X} + z_{\alpha/2} C S/\sqrt{n}]
   $$
   当抽样比例为n/N = 5%时，C=0.97，当n/N=2%时，C=0.99。即当抽样比例低于5%时，估计误差不到1%。

6. 比例估计问题

   比例问题是一个0-1问题，总体分布为
   $$
   P(X=1) = p，P(X=0)=1-p
   $$
   其均值和方差为
   $$
   \mu = E(X=1) = p，\sigma^2 = Var(X) = p(1-p)
   $$
   其样本均值或样本比例为
   $$
   \overline{X} = \hat{p} = \frac{k}{n}
   $$
   其中k服从二项分布，其均值和方差分别为
   $$
   E(k) = np，Var(k) =  np(1-p)
   $$
   在大样本的情况下，近似成立
   $$
   Z = \frac{\hat{p} - p}{\sqrt{\hat{p}(1-\hat{p})} / n} = \frac{k - np}{\sqrt{n \hat{p}(1-\hat{p})}} \sim N(0,1）
   $$
   于是，得到总体比例p的区间估计，在置信度$1-\alpha$ 下的置信区间为
   $$
   [\hat{p} - z_{\alpha/2} \sqrt{\hat{p}(1-\hat{p})/n}，\hat{p} +z_{\alpha/2} \sqrt{\hat{p}(1-\hat{p})/n}]
   $$
   样本量大小计算公式为
   $$
   n = z_{\alpha/2}^2 \hat{p}(1-\hat{p}) / \Delta^2
   $$
   比例p的置信区间的校正公式（n不大时比较有用）
   $$
   \hat{p} \pm [\frac{1}{2n} + z_{\alpha/2 \sqrt{\hat{p}(1-\hat{p})/n}}]
   $$
   例如：总体数量为n=1600，调查数量为k=900，则p的区间估计（置信度为95%）为
   $$
   \frac{9}{16} \pm 0.0246 = 0.5625 \pm 0.0246 
   $$
   ​


##第四讲 
















