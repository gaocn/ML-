## 鲍威尔(Powell)共轭方向

一维极值搜索算法：Golden Ratio Search（黄金比例搜索法）、Fibonacci Search（斐波纳契搜索法）

Powell是一种非常稳健的非线性最优化算法，Powell算法可以轻松地解决多维(维度 < 20)情况下的最优化问题，Powell方法是一种“共轭方向”法，共轭方向就是不会“互相影响”的方向。例如：想从A地点走到B地点，但是我规定你走的每一步与下一步都不能互相影响，请问你该如何走？那么，你可以先水平地走一段路，再垂直地走一段路，再水平地走一段路……这样，每一步与下一步都不会互相影响了。反之，如果你先沿非水平的方向走了一段路，又沿垂直的方向走了一段路，则：在非水平方向上走的那段路，其实是对垂直方向走的那段路是有影响的，因为它不是水平的，所以它有垂直方向上的分量，因此相当于你在垂直方向上也走了一段分量的路，这就是”相互影响“的例子。

**为什么基于共轭方向的搜索算法可以到达极值点？** 

`共轭方向的性质`：设$P_1 ,P_2 ,…,P_n$是关于A的n个互相共轭的向量，则对于求正定二次函数$f(X)=\frac{1}{2}(X^TAX)+b^TX+c$（其中$b=[b_1,b_2,...,b_n]^T$ 为常列向量，$X=[X_1,X_2,...,X_n]^T$ 为变列向量）的极小点，只需从任意初始点出发，依次沿$P_i (i=1,2,…,n)$方向进行一维最优化搜索，至多n步便可以收敛到极小点，其最后所达的点必是n维正定二次目标函数的极小值点。简言之：沿n元二次正定函数的n个共轭方向进行n次一维搜索就可达到目标函数的极小值点。

由于在搜索的过程中，某些共轭方向可能会变得线性相关，导致“共轭”性质丢失，使得搜索失效，因此，我们需要用一定的策略来调整共轭方向集中的方向，使得搜索可以收敛到正确的点。



**黄金比例搜索算法(Golden Section/Radio Search)**

一种精确的一维搜索（Line Search）搜索算法，黄金比例搜索算法只需要计算目标函数值而不需要计算导数。

要使用黄金比例搜索算法，函数$f(x)$需要在某一区间内满足单峰（Unimodal）条件。

**单峰区间和单峰函数** ：$[a,b]$为$R$的子集，存在$a^* \in [a,b]$，使得$f(a)$在$[a,a^*]$上是单调递减，在$[a^*,b]$上严格单调递增，则称$[a,b]$是$f(a)$的单峰区间，$f(a)$是$[a,b]$上的单峰函数。例如：$f(x) = x^2$在$[-2,2]$上是单峰函数，而$f(x)=sinx$在$[0,2\pi]$ 区间上就不是单峰函数而在$[\pi,2\pi]$上则是单峰函数。

**划界如何实现？** 思想是寻找使函数值达到“高-低-高”的三个点，



### 原始Powell算法流程

1. 初始点$x_0$，n个线性无关的搜索方向$d_0, d_1, ...,d_{n-1}$，允许误差为$\epsilon$ ，令$k \leftarrow 0$ ； 

2. 进行基本搜索，依次沿着$d_0, d_1, ...,d_{n-1}$进行一维搜索，$x_i$的更新公式如下
   $$
   f(x_{j-1} + \lambda_{j-1} \ d_{j-1}) = min \{ x_{j-1} + \lambda_{j-1} \ d_{j-1} \} \\
   \Downarrow \\
   \lambda_{j-1} \\
   \Downarrow \\
   x_{j} = x_{j-1} + \lambda_{j-1} \ d_{j-1}，j=1,2,...,n \\
   $$

3. 进行加速搜索，取加速方向$d_n = y_n - y_0$ ，若$||d_n|| \lt \epsilon$则迭代终止，$x_n$为最优解；否则，从点$x_n$出发沿$d_n$方向一维搜索，根据$f(x_{n} + \lambda_{n} \ d_{n}) = min \{ x_{n} + \lambda_{n} \ d_{n} \}$求得$\lambda_n$ ，更新$x_{n+1} = x_n + \lambda_n d_n$，转到第4步；

4. 调整搜索方向，在原来的n个搜索方向$d_0, d_1, ...,d_{n-1}$中去掉$d_0$加入$d_n$构建新的n个搜索方向$d_1, d_2, ...,d_{n}$，令$k \leftarrow k+1$，转到第2步继续搜索。

**举例说明**

如下图所示，以二维二次目标函数为例子，则由共轭方向搜索的性质可知在二次搜索后就能够得到最优解。选取初始点为$x_0$，搜索方向为$d_0=[1,0],d_1=[0,1]$ ，搜索步骤如下

- 第一轮循环，$x_0$沿着方向$d_0,d_1$得到$x_2$，则得到新的方向$d_2=\vec{x_2 - x_1}$ ，若$||d_2|| \lt \epsilon$则搜索停止；否则确定性的搜索方向为$d_1,d_2$(由共轭性质可得到两者共轭) 新的起始搜索点为$x_3 = x_2 + \lambda_2 d_2$
- 第二轮循环，$x_3$沿着方向$d_1,d_2$得到$x_5$，则得到新的方向$d_3=\vec{x_5 - x_4}$ ，若$||d_3|| \lt \epsilon$则搜索停止；

![Powell算法流程](D:\SoftwareForWin10\ML\img\md_imgs\Powell算法流程.png)

**原始Powell算法缺点**

在鲍威尔算法中，每一轮迭代都是连接始点和终点所产生的新搜索方向去机械地替换原方向组的第一个搜索方向，而不做任何“好坏”的判断，这正是产生向量线性相关而发生“退化”的根本原因。如下图所示，当某一循环方向组中的矢量出现*线性相关* （退化、病态）时，搜索过程会在*降维* 空间进行，致使算法不能收敛而失败。

![Powell算法缺陷](D:\SoftwareForWin10\ML\img\md_imgs\Powell算法缺陷.png)

### 修正Powell算法

为了避免“退化”现象，鲍威尔对算法进行了修正， 在每一轮产生新的搜索方向$d_k$后，首先判断原搜索方向组是否可以直接用作下一轮迭代的搜索方向组，若可以则仍然使用之，否则，还要进一步判断原搜索方向组中哪个方向上函数值下降量最大或贡献最大，然后再用。新搜索方向替换这个贡献量最大的搜索方向，以保证逐次生成共轭方向，即每一轮迭代的搜索方向组线性无关。

对第k轮迭代，记$f_1=f(X_0^{(k)})，f_2=f(X_n^{(k)})，f_3=f(2X_n^{(k)}- X_0^{(i)}) $，及$\Delta_m^{(k)}=max\{[f(X_{i-1}^{(k)} - f(X_i^{(k)})],i=1,2,...,n\}$并记$d_m^{(k)}$为与$\Delta_m^{(k)}$相对应的搜索方向，且$d^{(k)} = X_n^{(k)} - X_0^{(k)}$，**鲍威尔条件**为若
$$
f_3 \lt f_1 且 \\
(f_1 - 2f_2 + f_3)(f_1 - f_2 - \Delta_m^{(k)}) \lt 0.5 \Delta_m^{(k)}(f_1-f_3)^2
$$
同时成立，则用$d^{(k)}$替代$d_m^{(k)}$ ；否则，仍用原搜索方向组，这就是**鲍威尔修正算法**。 

**修正Powell算法流程**

1. 初始点$x_0$，n个线性无关的搜索方向为单位坐标系向量组$d_i=e_i， i=1,2, ...,n$，迭代收敛精度$\epsilon_1，\epsilon_2$ ，令$k \leftarrow 0$ ； 

2. 进行基本搜索，依次沿着$d_1, d_2, ...,d_n$进行一维搜索得到n个极小值点$X_i，i=1,2,...,n$，$X_i$的更新公式如下
   $$
   f(x_{j-1} + \lambda_{j-1} \ d_{j-1}) = min \{ x_{j-1} + \lambda_{j-1} \ d_{j-1} \} \\
   \Downarrow \\
   \lambda_{j-1} \\
   \Downarrow \\
   x_{j} = x_{j-1} + \lambda_{j-1} \ d_{j-1}，j=1,2,...,n \\
   $$

   构造新的搜索方向$d^{(k)}=X_n^{(k)} - X_0^{(k)}$，并沿吃饭先进行一维搜索得到极小值点$X_{n+1}^{(k)}$；

3. 判断迭代终止条件，
   $$
   ||X_{n+1}^{(k)} - X_0^{(k)}|| \le \epsilon_1 \quad 或 \\
   |f(X_{n+1}^{(k)}) - f(X_0^{(k)})| \le \epsilon_2|f(X_{n+1}^{(k)})|
   $$
   则满足，终止迭代并输出最优解$X^*=X_{n+1}^{(k)}和f^*=f(X^*)$；否则进行下一步；

4. 计算$f(X_i^{(k)})，i=1,2,...,n$ ，并求
   $$
   \Delta_m^{(k)} = max \{ [f(x_{i-1}^{(k)}) - f(X_i^{(k)})] \} = f_{m-1}-f_m，i=1,2,...,n
   $$
   及与之对应的两个点$X_{m-1}^{(k)}和X_m^{(k)}$，则第k轮迭代中贡献最大的方向为
   $$
   d_m^{(k)} = X_m^{(k)} - X_{m-1}^{(k)}
   $$

5. 确定映射点$X^{(k)}=2X_n^{(k)} - X_0^{(k)}$，并计算$f(X^{(k)})$，记$f_1=f(X_0^{(k)})，f_2=f(X_n^{(k)})，f_3=f(X^{(k)})$，检查是否满足鲍威尔条件，若满足，则转下一步；否则，转第7步；

6. 置第k+1轮迭代的出发点和搜索方向组为（用$d^{(k)}替换d^{(k)}_m$）
   $$
   出发点：X_0^{(k+1)} = X_{n+1}^{(k+1)}  \\
   方向组：d_i^{(k+1)} = \{ d_1^{(k)},d_2^{(k)},...,d_{m-1}^{(k)},d^{(k)},d_{m+1}^{(k)},...d_n^{(k)} \}
   $$

   并令$k \leftarrow k+1$，转到第2步；

7. 置第k+1轮迭代的出发点和搜索方向组为
   $$
   若f_2 < f_3，X_0^{(k+1)}=X_n^{(k)}；否则，X_0^{(k+1)}=X^{(k)} \\
   方向组：d_i^{(k+1)} = \{ d_1^{(k)},d_2^{(k)},..., d_n^{(k)} \}
   $$

   并令$k \leftarrow k+1$，转到第2步；











